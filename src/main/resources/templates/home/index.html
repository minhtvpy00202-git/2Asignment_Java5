<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trang chủ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/components.css}">
    <link rel="stylesheet" th:href="@{/css/pages.css}">
</head>
<body>
<div th:replace="layout/layout :: header"></div>

<main class="container" style="padding: 16px;">
    <section class="hero">
        <h1>Mua sắm thông minh – Phong cách hiện đại</h1>
        <p>Sản phẩm chính hãng, giá tốt, giao hàng nhanh. Lựa chọn tối ưu cho phong cách mỗi ngày.</p>
        <div class="hero-actions">
            <a class="btn" th:href="@{/home/index#san-pham}">Mua ngay</a>
            <a class="btn btn-outline" th:href="@{/home/index#san-pham}">Xem sản phẩm</a>
        </div>
    </section>

    <section class="promo-grid">
        <div class="promo-item card">
            <div class="promo-title">Miễn phí vận chuyển</div>
            <div class="promo-desc">Áp dụng cho đơn từ 500.000đ toàn quốc.</div>
        </div>
        <div class="promo-item card">
            <div class="promo-title">Đổi trả dễ dàng</div>
            <div class="promo-desc">7 ngày đổi trả vì bất kỳ lý do nào.</div>
        </div>
        <div class="promo-item card">
            <div class="promo-title">Hỗ trợ nhanh chóng</div>
            <div class="promo-desc">Hotline 24/7, tư vấn tận tâm.</div>
        </div>
        <div class="promo-item card">
            <div class="promo-title">Thanh toán linh hoạt</div>
            <div class="promo-desc">COD, chuyển khoản, thẻ nội địa.</div>
        </div>
    </section>

    <div class="catalog-layout">
    <aside class="filters-sidebar">
    <form class="filters filters-vertical card" th:action="@{/home/index}" method="get">
        <input type="hidden" name="page" value="0">
        <div class="form-group">
            <label>Tìm kiếm</label>
            <input type="text" name="keyword" placeholder="Nhập tên hoặc danh mục..."
                   th:value="${keyword}">
        </div>
        <div class="form-group">
            <label>Danh mục</label>
            <select name="categoryId">
                <option value="" th:selected="${selectedCategoryId == null or selectedCategoryId == ''}">
                    Tất cả danh mục
                </option>
                <option th:each="c : ${categories}"
                        th:value="${c.id}"
                        th:text="${c.name}"
                        th:selected="${selectedCategoryId == c.id}">
                </option>
            </select>
        </div>
        <div class="form-group">
            <label>Giá từ</label>
            <input type="number" name="minPrice" placeholder="0"
                   th:value="${minPrice}">
        </div>
        <div class="form-group">
            <label>Giá đến</label>
            <input type="number" name="maxPrice" placeholder="2.000.000"
                   th:value="${maxPrice}">
        </div>
        <div class="form-group">
            <label>Khoảng giá</label>
            <select name="priceRange">
                <option value="" th:selected="${priceRange == null or priceRange == ''}" class="placeholder-option">Chọn nhanh</option>
                <option value="under_500" th:selected="${priceRange == 'under_500'}">Dưới 500.000đ</option>
                <option value="500_1m" th:selected="${priceRange == '500_1m'}">500.000đ - 1.000.000đ</option>
                <option value="1m_2m" th:selected="${priceRange == '1m_2m'}">1.000.000đ - 2.000.000đ</option>
                <option value="over_2m" th:selected="${priceRange == 'over_2m'}">Trên 2.000.000đ</option>
            </select>
        </div>
        <div class="form-group">
            <label>Sắp xếp</label>
            <select name="sort">
                <option value="" th:selected="${sort == null or sort == ''}" class="placeholder-option">Mặc định</option>
                <option value="price_asc" th:selected="${sort == 'price_asc'}">Giá tăng dần</option>
                <option value="price_desc" th:selected="${sort == 'price_desc'}">Giá giảm dần</option>
            </select>
        </div>
        <div class="form-group filter-actions">
            <button class="btn" type="submit" aria-label="Lọc">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"></path>
                </svg>
            </button>
            <a class="btn btn-outline nowrap" th:href="@{/home/index}" aria-label="Xoá lọc">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M4 4h16l-6 7v6l-4 2v-6L4 4zM15 4l5 5m0-5-5 5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"></path>
                </svg>
            </a>
        </div>
    </form>
    </aside>
    <div class="catalog-content">

    <section class="section" th:if="${filteredProducts != null}">
        <div class="section-header">
            <h3 class="page-title">Kết quả tìm kiếm</h3>
        </div>
        <div class="product-grid">
            <div class="product-card"
                 th:each="p : ${filteredProducts}"
                 th:with="firstSize=${p.productSizes.?[quantity > 0][0]}"
                 th:data-detail-url="@{|/product/detail/${p.id}|}">
                <div class="product-image-wrap">
                    <div class="product-image-frame">
                        <span class="discount-tag"
                              th:if="${p.discount != null and p.discount > 0}"
                              th:text="'-' + ${#numbers.formatDecimal(p.discount, 0, 'POINT', 0, 'COMMA')} + '%'">-0%</span>
                        <div class="size-overlay">
                            <div class="size-box">
                                <div class="size-title">Chọn size nhanh</div>
                                <div class="size-options">
                                    <a th:each="ps : ${p.productSizes}"
                                       th:if="${ps.quantity > 0}"
                                       th:href="@{|/cart/add/${p.id}?sizeId=${ps.size.id}|}"
                                       th:text="${ps.size.name}">M</a>
                                    <span class="size-disabled"
                                          th:each="ps : ${p.productSizes}"
                                          th:if="${ps.quantity <= 0}"
                                          th:attr="data-size=${ps.size.name}"
                                          th:text="${ps.size.name}">M</span>
                                </div>
                            </div>
                        </div>
                        <img th:src="${#strings.isEmpty(p.image)} ? @{/images/product1.jpg} : @{|/images/${p.image}|}"
                             alt="product">
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-name" th:text="${p.name}">Tên sản phẩm</div>
                    <div class="product-bottom">
                        <div class="price-row">
                            <span class="price-old" th:if="${p.discount != null and p.discount > 0}"
                                  th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'COMMA')} + ' VNĐ'">0</span>
                            <span class="price-amount"
                                  th:text="${#numbers.formatDecimal((p.discount != null and p.discount > 0) ? (p.price - (p.price * p.discount / 100)) : p.price, 0, 'POINT', 0, 'COMMA')}">0</span><span class="price-currency">VNĐ</span>
                        </div>
                        <button class="cart-quick-btn"
                                type="button"
                                th:attr="data-product-id=${p.id},data-size-id=${firstSize != null ? firstSize.size.id : ''}"
                                th:classappend="${cartProductIds.contains(p.id)} ? 'in-cart'">
                            <svg class="cart-icon cart-add" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                            </svg>
                            <svg class="cart-icon cart-check" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                                <path d="M16.3 9.7a1 1 0 0 1 1.4 0l1.3 1.3 2.9-2.9a1 1 0 0 1 1.4 1.4l-3.6 3.6a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 0-1.4z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="pagination" th:if="${totalPages != null and totalPages > 1}">
            <a class="page-link"
               th:href="@{/home/index(page=${currentPage - 1},size=${pageSize},keyword=${keyword},categoryId=${selectedCategoryId},minPrice=${minPrice},maxPrice=${maxPrice},priceRange=${priceRange},sort=${sort})}"
               th:classappend="${currentPage == 0} ? 'disabled'">Trước</a>
            <a class="page-link"
               th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
               th:text="${i + 1}"
               th:href="@{/home/index(page=${i},size=${pageSize},keyword=${keyword},categoryId=${selectedCategoryId},minPrice=${minPrice},maxPrice=${maxPrice},priceRange=${priceRange},sort=${sort})}"
               th:classappend="${i == currentPage} ? 'active'">1</a>
            <a class="page-link"
               th:href="@{/home/index(page=${currentPage + 1},size=${pageSize},keyword=${keyword},categoryId=${selectedCategoryId},minPrice=${minPrice},maxPrice=${maxPrice},priceRange=${priceRange},sort=${sort})}"
               th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">Sau</a>
        </div>
    </section>

    <section class="section" id="san-pham">
        <div class="section-header">
            <h3 class="page-title">Hàng mới</h3>
        </div>
        <div class="product-grid">
            <div class="product-card"
                 th:each="p : ${newProducts}"
                 th:with="firstSize=${p.productSizes.?[quantity > 0][0]}"
                 th:data-detail-url="@{|/product/detail/${p.id}|}">
                <div class="product-image-wrap">
                    <div class="product-image-frame">
                        <span class="discount-tag"
                              th:if="${p.discount != null and p.discount > 0}"
                              th:text="'-' + ${#numbers.formatDecimal(p.discount, 0, 'POINT', 0, 'COMMA')} + '%'">-0%</span>
                        <div class="size-overlay">
                            <div class="size-box">
                                <div class="size-title">Chọn size nhanh</div>
                                <div class="size-options">
                                    <a th:each="ps : ${p.productSizes}"
                                       th:if="${ps.quantity > 0}"
                                       th:href="@{|/cart/add/${p.id}?sizeId=${ps.size.id}|}"
                                       th:text="${ps.size.name}">M</a>
                                    <span class="size-disabled"
                                          th:each="ps : ${p.productSizes}"
                                          th:if="${ps.quantity <= 0}"
                                          th:attr="data-size=${ps.size.name}"
                                          th:text="${ps.size.name}">M</span>
                                </div>
                            </div>
                        </div>
                        <img th:src="${#strings.isEmpty(p.image)} ? @{/images/product1.jpg} : @{|/images/${p.image}|}"
                             alt="product">
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-name" th:text="${p.name}">Tên sản phẩm</div>
                    <div class="price-row">
                        <span class="price-old" th:if="${p.discount != null and p.discount > 0}"
                                  th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'COMMA')} + ' VNĐ'">0</span>
                        <span class="price-amount"
                                  th:text="${#numbers.formatDecimal((p.discount != null and p.discount > 0) ? (p.price - (p.price * p.discount / 100)) : p.price, 0, 'POINT', 0, 'COMMA')}">0</span><span class="price-currency">VNĐ</span>
                    </div>
                </div>
                <button class="cart-quick-btn"
                        type="button"
                        th:attr="data-product-id=${p.id},data-size-id=${firstSize != null ? firstSize.size.id : ''}"
                        th:classappend="${cartProductIds.contains(p.id)} ? 'in-cart'">
                    <svg class="cart-icon cart-add" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                    </svg>
                    <svg class="cart-icon cart-check" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                        <path d="M16.3 9.7a1 1 0 0 1 1.4 0l1.3 1.3 2.9-2.9a1 1 0 0 1 1.4 1.4l-3.6 3.6a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 0-1.4z"/>
                    </svg>
                </button>
                
            </div>
        </div>
    </section>

    <section class="section">
        <div class="section-header">
            <h3 class="page-title">Hàng giảm giá</h3>
        </div>
        <div class="product-grid">
            <div class="product-card"
                 th:each="p : ${discountProducts}"
                 th:with="firstSize=${p.productSizes.?[quantity > 0][0]}"
                 th:data-detail-url="@{|/product/detail/${p.id}|}">
                <div class="product-image-wrap">
                    <div class="product-image-frame">
                        <span class="discount-tag"
                              th:if="${p.discount != null and p.discount > 0}"
                              th:text="'-' + ${#numbers.formatDecimal(p.discount, 0, 'POINT', 0, 'COMMA')} + '%'">-0%</span>
                        <div class="size-overlay">
                            <div class="size-box">
                                <div class="size-title">Chọn size nhanh</div>
                                <div class="size-options">
                                    <a th:each="ps : ${p.productSizes}"
                                       th:if="${ps.quantity > 0}"
                                       th:href="@{|/cart/add/${p.id}?sizeId=${ps.size.id}|}"
                                       th:text="${ps.size.name}">M</a>
                                    <span class="size-disabled"
                                          th:each="ps : ${p.productSizes}"
                                          th:if="${ps.quantity <= 0}"
                                          th:attr="data-size=${ps.size.name}"
                                          th:text="${ps.size.name}">M</span>
                                </div>
                            </div>
                        </div>
                        <img th:src="${#strings.isEmpty(p.image)} ? @{/images/product1.jpg} : @{|/images/${p.image}|}"
                             alt="product">
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-name" th:text="${p.name}">Tên sản phẩm</div>
                    <div class="price-row">
                        <span class="price-old" th:if="${p.discount != null and p.discount > 0}"
                                  th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'COMMA')} + ' VNĐ'">0</span>
                        <span class="price-amount"
                                  th:text="${#numbers.formatDecimal((p.discount != null and p.discount > 0) ? (p.price - (p.price * p.discount / 100)) : p.price, 0, 'POINT', 0, 'COMMA')}">0</span><span class="price-currency">VNĐ</span>
                    </div>
                </div>
                <button class="cart-quick-btn"
                        type="button"
                        th:attr="data-product-id=${p.id},data-size-id=${firstSize != null ? firstSize.size.id : ''}"
                        th:classappend="${cartProductIds.contains(p.id)} ? 'in-cart'">
                    <svg class="cart-icon cart-add" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                    </svg>
                    <svg class="cart-icon cart-check" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                        <path d="M16.3 9.7a1 1 0 0 1 1.4 0l1.3 1.3 2.9-2.9a1 1 0 0 1 1.4 1.4l-3.6 3.6a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 0-1.4z"/>
                    </svg>
                </button>
                
            </div>
        </div>
    </section>

    <section class="section">
        <div class="section-header">
            <h3 class="page-title">Hàng bán chạy</h3>
        </div>
        <div class="product-grid">
            <div class="product-card"
                 th:each="p : ${bestSellerProducts}"
                 th:with="firstSize=${p.productSizes.?[quantity > 0][0]}"
                 th:data-detail-url="@{|/product/detail/${p.id}|}">
                <div class="product-image-wrap">
                    <div class="product-image-frame">
                        <span class="discount-tag"
                              th:if="${p.discount != null and p.discount > 0}"
                              th:text="'-' + ${#numbers.formatDecimal(p.discount, 0, 'POINT', 0, 'COMMA')} + '%'">-0%</span>
                        <div class="size-overlay">
                            <div class="size-box">
                                <div class="size-title">Chọn size nhanh</div>
                                <div class="size-options">
                                    <a th:each="ps : ${p.productSizes}"
                                       th:if="${ps.quantity > 0}"
                                       th:href="@{|/cart/add/${p.id}?sizeId=${ps.size.id}|}"
                                       th:text="${ps.size.name}">M</a>
                                    <span class="size-disabled"
                                          th:each="ps : ${p.productSizes}"
                                          th:if="${ps.quantity <= 0}"
                                          th:attr="data-size=${ps.size.name}"
                                          th:text="${ps.size.name}">M</span>
                                </div>
                            </div>
                        </div>
                        <img th:src="${#strings.isEmpty(p.image)} ? @{/images/product1.jpg} : @{|/images/${p.image}|}"
                             alt="product">
                    </div>
                </div>
                <div class="product-info">
                    <div class="product-name" th:text="${p.name}">Tên sản phẩm</div>
                    <div class="price-row">
                        <span class="price-old" th:if="${p.discount != null and p.discount > 0}"
                                  th:text="${#numbers.formatDecimal(p.price, 0, 'POINT', 0, 'COMMA')} + ' VNĐ'">0</span>
                        <span class="price-amount"
                                  th:text="${#numbers.formatDecimal((p.discount != null and p.discount > 0) ? (p.price - (p.price * p.discount / 100)) : p.price, 0, 'POINT', 0, 'COMMA')}">0</span><span class="price-currency">VNĐ</span>
                    </div>
                </div>
                <button class="cart-quick-btn"
                        type="button"
                        th:attr="data-product-id=${p.id},data-size-id=${firstSize != null ? firstSize.size.id : ''}"
                        th:classappend="${cartProductIds.contains(p.id)} ? 'in-cart'">
                    <svg class="cart-icon cart-add" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                    </svg>
                    <svg class="cart-icon cart-check" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 4h-2l-1 2h2l3.6 7.59-1.35 2.44A2 2 0 0 0 9 19h9v-2H9.42a.25.25 0 0 1-.22-.37l.9-1.63h5.6a2 2 0 0 0 1.8-1.1l3.1-6.2A1 1 0 0 0 19.7 6H6.2l-.8-2zM7 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm10 0a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                        <path d="M16.3 9.7a1 1 0 0 1 1.4 0l1.3 1.3 2.9-2.9a1 1 0 0 1 1.4 1.4l-3.6 3.6a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 0-1.4z"/>
                    </svg>
                </button>
                
            </div>
        </div>
    </section>
    </div>
    </div>
</main>

<div th:replace="layout/layout :: footer"></div>
</body>
</html>
